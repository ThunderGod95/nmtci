<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>No Money to Cultivate Immortality</title>
        <style>
            :root {
                --text-size: 16px;
                --line-height: 1.6;
                --bg-color: #fdfdfd;
                --text-color: #333;
            }

            body {
                max-width: 800px;
                margin: 0 auto;
                padding: 40px 20px;
                background-color: var(--bg-color);
                color: var(--text-color);
                font-size: var(--text-size);
                line-height: var(--line-height);
                font-family:
                    "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
                    sans-serif;
                transition: all 0.1s;
            }

            .fab-container {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 1000;
                display: flex;
                flex-direction: column;
                align-items: flex-end;
            }

            .settings-btn {
                background-color: var(--text-color);
                color: var(--bg-color);
                border: none;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                cursor: pointer;
                font-size: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .settings-btn svg {
                fill: var(--bg-color);
            }

            .settings-menu {
                background: white;
                border: 1px solid #ddd;
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 10px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                display: none;
                width: 250px;
            }

            .settings-menu.active {
                display: block;
            }

            .setting-item {
                margin-bottom: 15px;
            }

            .setting-item label {
                display: block;
                font-size: 14px;
                margin-bottom: 5px;
                font-weight: bold;
                color: #333;
            }

            .setting-item input[type="range"] {
                width: 100%;
                cursor: pointer;
                accent-color: #ccc;
            }

            .value-display {
                font-size: 12px;
                color: #666;
                float: right;
            }

            .theme-selector {
                display: flex;
                gap: 12px;
                justify-content: flex-start;
            }

            .theme-btn {
                width: 35px;
                height: 35px;
                border-radius: 50%;
                border: 2px solid #ddd;
                cursor: pointer;
                position: relative;
                transition:
                    transform 0.2s,
                    border-color 0.2s;
            }

            .theme-btn:hover {
                transform: scale(1.1);
            }

            .theme-btn.active {
                border-color: var(--text-color);
                transform: scale(1.1);
                box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
            }

            #progress-container {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 6px;
                background: transparent;
                z-index: 2000;
            }

            #progress-bar {
                height: 100%;
                background: var(--text-color);
                width: 0%;
                transition: width 0.1s;
                opacity: 0.7;
            }

            @media (max-width: 600px) {
                body {
                    padding: 20px;
                }
            }
        </style>
    </head>
    <body>
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>

        <div id="content">{{ content }}</div>

        <div class="fab-container">
            <div class="settings-menu" id="settingsMenu">
                <div class="setting-item">
                    <label
                        >Font Size
                        <span id="fs-val" class="value-display"
                            >18px</span
                        ></label
                    >
                    <input
                        type="range"
                        id="input-fontsize"
                        min="14"
                        max="32"
                        value="18"
                    />
                </div>
                <div class="setting-item">
                    <label
                        >Line Height
                        <span id="lh-val" class="value-display"
                            >1.6</span
                        ></label
                    >
                    <input
                        type="range"
                        id="input-lineheight"
                        min="1.2"
                        max="2.4"
                        step="0.1"
                        value="1.6"
                    />
                </div>
                <div class="setting-item">
                    <label>Theme</label>
                    <div class="theme-selector">
                        <button
                            class="theme-btn"
                            data-theme="light"
                            style="background-color: #fdfdfd"
                            title="Light"
                            aria-label="Light Theme"
                        ></button>

                        <button
                            class="theme-btn"
                            data-theme="sepia"
                            style="background-color: #f4ecd8"
                            title="Sepia"
                            aria-label="Sepia Theme"
                        ></button>

                        <button
                            class="theme-btn"
                            data-theme="dark"
                            style="background-color: #222222"
                            title="Dark"
                            aria-label="Dark Theme"
                        ></button>
                    </div>
                </div>
            </div>
            <button
                class="settings-btn"
                id="toggleSettings"
                aria-label="Settings"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    height="24"
                    width="24"
                    viewBox="0 0 640 640"
                >
                    <!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.-->
                    <path
                        d="M259.1 73.5C262.1 58.7 275.2 48 290.4 48L350.2 48C365.4 48 378.5 58.7 381.5 73.5L396 143.5C410.1 149.5 423.3 157.2 435.3 166.3L503.1 143.8C517.5 139 533.3 145 540.9 158.2L570.8 210C578.4 223.2 575.7 239.8 564.3 249.9L511 297.3C511.9 304.7 512.3 312.3 512.3 320C512.3 327.7 511.8 335.3 511 342.7L564.4 390.2C575.8 400.3 578.4 417 570.9 430.1L541 481.9C533.4 495 517.6 501.1 503.2 496.3L435.4 473.8C423.3 482.9 410.1 490.5 396.1 496.6L381.7 566.5C378.6 581.4 365.5 592 350.4 592L290.6 592C275.4 592 262.3 581.3 259.3 566.5L244.9 496.6C230.8 490.6 217.7 482.9 205.6 473.8L137.5 496.3C123.1 501.1 107.3 495.1 99.7 481.9L69.8 430.1C62.2 416.9 64.9 400.3 76.3 390.2L129.7 342.7C128.8 335.3 128.4 327.7 128.4 320C128.4 312.3 128.9 304.7 129.7 297.3L76.3 249.8C64.9 239.7 62.3 223 69.8 209.9L99.7 158.1C107.3 144.9 123.1 138.9 137.5 143.7L205.3 166.2C217.4 157.1 230.6 149.5 244.6 143.4L259.1 73.5zM320.3 400C364.5 399.8 400.2 363.9 400 319.7C399.8 275.5 363.9 239.8 319.7 240C275.5 240.2 239.8 276.1 240 320.3C240.2 364.5 276.1 400.2 320.3 400z"
                    />
                </svg>
            </button>
        </div>

        <script>
            const root = document.documentElement;
            const menu = document.getElementById("settingsMenu");
            const btn = document.getElementById("toggleSettings");
            const inputFs = document.getElementById("input-fontsize");
            const inputLh = document.getElementById("input-lineheight");
            const displayFs = document.getElementById("fs-val");
            const displayLh = document.getElementById("lh-val");
            const progressBar = document.getElementById("progress-bar");

            const themes = {
                light: { bg: "#fdfdfd", text: "#333333" },
                sepia: { bg: "#f4ecd8", text: "#5b4636" },
                dark: { bg: "#222222", text: "#d1d1d1" },
            };

            function updateThemeUI(activeTheme) {
                document.querySelectorAll(".theme-btn").forEach((btn) => {
                    if (btn.dataset.theme === activeTheme) {
                        btn.classList.add("active");
                    } else {
                        btn.classList.remove("active");
                    }
                });
            }

            function applyTheme(themeName) {
                const theme = themes[themeName] || themes.light;
                root.style.setProperty("--bg-color", theme.bg);
                root.style.setProperty("--text-color", theme.text);
                updateThemeUI(themeName);
                return themeName;
            }

            function loadSettings() {
                const savedSettings = localStorage.getItem("reader-settings");
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);

                    root.style.setProperty(
                        "--text-size",
                        settings.fontSize + "px",
                    );
                    root.style.setProperty(
                        "--line-height",
                        settings.lineHeight,
                    );
                    inputFs.value = settings.fontSize;
                    inputLh.value = settings.lineHeight;
                    displayFs.textContent = settings.fontSize + "px";
                    displayLh.textContent = settings.lineHeight;

                    applyTheme(settings.theme || "light");
                } else {
                    applyTheme("light");
                }

                const savedScroll = localStorage.getItem("reader-scroll-pos");
                if (savedScroll) {
                    setTimeout(() => {
                        window.scrollTo(0, parseInt(savedScroll));
                    }, 100);
                }
            }

            function saveSettings() {
                const activeBtn = document.querySelector(".theme-btn.active");
                const currentTheme = activeBtn
                    ? activeBtn.dataset.theme
                    : "light";

                const settings = {
                    fontSize: inputFs.value,
                    lineHeight: inputLh.value,
                    theme: currentTheme,
                };
                localStorage.setItem(
                    "reader-settings",
                    JSON.stringify(settings),
                );
            }

            function updateProgress() {
                const scrollTop = window.scrollY;
                const docHeight =
                    document.body.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                progressBar.style.width = scrollPercent + "%";
                localStorage.setItem("reader-scroll-pos", scrollTop);
            }

            document.querySelectorAll(".theme-btn").forEach((btn) => {
                btn.addEventListener("click", (e) => {
                    const themeName = e.target.dataset.theme;
                    applyTheme(themeName);
                    saveSettings();
                });
            });

            btn.addEventListener("click", (e) => {
                e.stopPropagation();
                menu.classList.toggle("active");
            });

            document.addEventListener("click", (e) => {
                if (
                    menu.classList.contains("active") &&
                    !menu.contains(e.target)
                ) {
                    menu.classList.remove("active");
                }
            });

            menu.addEventListener("click", (e) => {
                e.stopPropagation();
            });

            inputFs.addEventListener("input", (e) => {
                const val = e.target.value;
                root.style.setProperty("--text-size", val + "px");
                displayFs.textContent = val + "px";
                saveSettings();
            });

            inputLh.addEventListener("input", (e) => {
                const val = e.target.value;
                root.style.setProperty("--line-height", val);
                displayLh.textContent = val;
                saveSettings();
            });

            window.addEventListener("scroll", updateProgress);
            window.addEventListener("resize", updateProgress);

            loadSettings();
        </script>
    </body>
</html>
